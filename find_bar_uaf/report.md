# Summary

When the find bar is hidden, a call to RequestFocus will be made on the previously active view. If that view has been destroyed, a user-after-free will occur in the browser process. Since an extension with the debugger permission can open the find bar, it can trigger the issue.

# Description

From debugging through some of the calls made when the focus is changed and the find bar is hidden, it appears the cause of the issue is as follows:

- When the focus is changed, a call is made to WindowedFindBarFocusProxyView::OnWillChangeFocus. That method will then store a pointer to the View that was focused.

- When a dialog is shown for a tab (e.g. the print preview dialog, web capture dialog, install app dialog), a call to OnWillChangeFocus will be made and the View pointer associated with the dialog will be stored by WindowedFindBarFocusProxyView.

- If another window is then made active and the dialog is destroyed (in the background), no call to OnWillChangeFocus will be made, since the original browser window isn't active. WindowedFindBarFocusProxyView will continue to hold a pointer to the now freed View.

- If the find bar is shown in the original tab, then hidden, BrowserView::OnBeforeHideFindBar will attempt to call View::RequestFocus on the previously active View. However, since the View has been destroyed, this will result in a use-after-free.

## Steps to Reproduce

1. Install the attached extension.
2. Once installed, the extension will create a window with a single tab and call window.print in that tab.
3. The extension will then create another window, marking it as focused.
4. The tab created in step 2 will then be navigated to about:blank. This will result in the print dialog being destroyed.
5. The extension will then switch focus to the original window.
6. It will then attach the debugger to the tab and dispatch the Ctrl+F shortcut using the Input.dispatchKeyEvent devtools protocol method.
7. The tab will then be discarded using chrome.tabs.discard. This will result in the find bar being hidden and a use-after-free being triggered in the browser process.