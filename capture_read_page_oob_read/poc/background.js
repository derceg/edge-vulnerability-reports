chrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) {
    if (changeInfo.status !== "complete") {
        return;
    }

    let url = new URL(tab.url);

    if (url.protocol !== "read:") {
        return;
    }

    onReadPageLoaded(tab);
});

function onReadPageLoaded(tab) {
    chrome.debugger.attach({tabId: tab.id}, "1.3", function () {
        onDebuggerAttachedToTab(tab);
    });
}

function onDebuggerAttachedToTab(tab) {
    chrome.debugger.sendCommand({tabId: tab.id}, "Page.getFrameTree", {}, function (result) {
        chrome.debugger.sendCommand({tabId: tab.id}, "Page.setDocumentContent",
            {frameId: result.frameTree.frame.id, html: "<p>Replacement content</p>"});
    });
}