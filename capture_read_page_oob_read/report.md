# Summary

When performing a full page capture on a read: page, if the data source frame isn't present (e.g. because the page content has been overwritten, or the page failed to load), an OOB read will be triggered in the browser process.

# Description

When a full page capture is performed, ContentWebShotDriver::GetFullPageRect will call FrameCaptureClient::GetFrameFromWebContents. GetFrameFromWebContents has special handling for read: URLs and will iterate through a list of all frames contained on the page.

The issue appears to be that when there's only a single frame, GetFrameFromWebContents will read past the end of the vector returned by GetAllFramesImpl. That is, there's no check to see whether the iterator is at the end of the vector and that iterator is then dereferenced, as if it refers to a valid element.

In terms of loading a read: page that only has a single frame, that can be done in several ways:

- By loading an invalid read: page (e.g. read://_/?url=). In that case, an error page will be shown and that page will only have a single frame.
- By loading a view-source:read:â€¦ URL. Again, the page will only have a single frame.
- If an extension has a devtools_page entry and the devtools is open on a read: page, the extension can remove the data source frame.
- If an extension has the debugger permission, it can overwrite the content on a read: page (as is demonstrated with the attached extension).

## Steps to Reproduce

1. Install the attached extension.
2. Open a read: URL in a tab.
3. Once the extension detects that a read: URL has been loaded, it will attach the debugger to the associated tab and use Page.setDocumentContent to overwrite the content of the page.
4. Once that has happened, right-click on the page and select the "Web capture" option from the context menu, then the "Capture full page" option. This should result in an OOB read occurring in the browser process, as described above.

It's also trivial to reproduce this issue without an extension:

1. Load read://_/?url= in a tab.
2. From the app menu, select "Web capture".
3. Select the "Capture full page" option. The same OOB read as described above should then occur.