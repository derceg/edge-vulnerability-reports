let tabUpdatedListener = null;

chrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) {
    if (tabUpdatedListener) {
        tabUpdatedListener(tabId, changeInfo, tab);
    }
});

startProcess();

function startProcess() {
    let targetTab = null;

    chrome.tabs.create({url: "manifest.json"}, function (tab) {
        targetTab = tab;
    });

    tabUpdatedListener = function (tabId, changeInfo, updatedTab) {
        if (targetTab
            && tabId === targetTab.id
            && changeInfo.status === "complete") {
            tabUpdatedListener = null;

            onTargetTabCreated(targetTab);
        }
    };
}

function onTargetTabCreated(tab) {
    chrome.debugger.attach({tabId: tab.id}, "1.3", function () {
        onDebuggerAttachedToTab(tab);
    });
}

function onDebuggerAttachedToTab(tab) {
    let keyCode = "I".charCodeAt(0);
    chrome.debugger.sendCommand({tabId: tab.id}, "Input.dispatchKeyEvent", {type: "rawKeyDown",
        key: "KeyI", windowsVirtualKeyCode: keyCode, nativeVirtualKeyCode: keyCode, modifiers: 10});
}