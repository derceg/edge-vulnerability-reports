# Summary

The webcapture: scheme and edge: scheme are effectively aliases for each other. However, devtools_page entries aren't stopped from scripting webcapture: pages, allowing an extension with a devtools_page entry to escape the sandbox.

# Description

As described above, webcapture: and edge: are effectively aliases of each other. The same is also true for the devtools: scheme. This has to do with the fact that, in Edge, these schemes are all listed under HasWebUIScheme:

https://source.chromium.org/chromium/chromium/src/+/main:content/public/common/url_utils.cc;l=24;drc=107c2a09ba3efd7638ebe612db97ca978dd26730

When GetWebUIFactoryFunction is called, it will return early for the chrome-untrusted: scheme:

https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/ui/webui/chrome_web_ui_controller_factory.cc;l=564;drc=b279b19ce82e667696a9f540491f75c9fe69b056

All other WebUI schemes will be processed and only the hostname will be used for comparison.

Ultimately, that means that any page that can be loaded under one of the WebUI schemes can also be loaded under any of the other WebUI schemes (excluding the chrome-untrusted: scheme).

In this particular case, webcapture://downloads is equivalent to edge://downloads and the relevant WebUI bindings are present and usable. However, the page won't properly load, as webcapture: doesn't have the ability to load from edge://resources (which is where various scripts are being loaded from).

That's not much of an issue, however. Because the WebUI bindings are present, those bindings can be used to open a download once the page can be scripted.

That's possible for an extension with a devtools_page entry. Whilst DevTools extensions are blocked on chrome:, edge: and devtools: pages, they're not blocked on webcapture: pages. That means that an extension with a devtools_page entry can script webcapture://downloads and use that to escape the sandbox by opening a downloaded executable.

The issue could be fixed by adding webcapture: to the list of schemes checked  in _canInspectURL:

https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/front_end/models/extensions/ExtensionServer.ts;l=1084;drc=d662bdf64b7d5168e7746f0cecf74598ec2ed445

## Steps to Reproduce

Note that the webcapture: scheme is only enabled when the kEdgeAddWebCapturetoCollections feature is enabled. The [release notes](https://techcommunity.microsoft.com/t5/discussions/dev-channel-update-to-93-0-946-1-is-live/m-p/2549200) for Edge dev 93.0.946.1 indicate that the feature has been fully rolled out there (see "Adding Web Captures to Collections"). In stable and beta, it appears the feature is still being progressively rolled out and may or may not be enabled yet.

Therefore, you can either install and test the attached extension in dev, or stable/beta when the kEdgeAddWebCapturetoCollections feature is enabled.

1. Install the attached extension.
2. Once installed, the extension will create a new tab, attach the debugger to that tab, then open the DevTools (by sending the Ctrl+Shift+I shortcut using Input.dispatchKeyEvent).
3. The target page will then be navigated to webcapture://downloads.
4. The extension page loaded within the DevTools will then download the target executable (in this case, Process Explorer) and use chrome.devtools.inspectedWindow.eval to run code within the context of the target page. That code will run the target executable by calling the appropriate Mojo method.