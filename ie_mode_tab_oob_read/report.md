# Summary

When a browser modal dialog is being shown and a tab loaded in IE mode is moved to a new window, an OOB read will occur in the browser process.

# Description

The direct cause here is that the active() method used in the following call returns -1:

https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/ui/tabs/tab_strip_model_order_controller.cc;l=151-152;drc=46bbb9795fcc1934c6cfbec096764f888c4d400a

That value is then passed through to TabStripModel::GetOpenerOfWebContentsAt:

https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/ui/tabs/tab_strip_model.cc;l=785;drc=69e84bba88eca6db0a30bbb10bbde502b832e0ec

which will result in an out-of-bounds read in the browser process.

It appears this issue is triggered whenever a browser modal dialog is being shown and an IE mode tab is moved into a new window. The attached extension uses a beforeunload dialog to demonstrate the issue, but you can also see the same issue when opening a variety of other dialogs. For example:

- The "Name this window" dialog
- The save as dialog
- The print dialog shown for an IE mode tab

## Steps to Reproduce

1. Install the attached extension.
2. Load a site in IE mode.
3. Once the extension detects that an IE mode tab has been loaded, it will create a new tab in the same window.
4. The extension will then navigate the new tab to about:blank. As the tab has a beforeunload handler, a confirmation dialog will be shown (which is browser modal).
5. The extension will then make the following call:

   ```javascript
   chrome.windows.create({tabId: ieTab.id});
   ```
   
   This will cause an OOB read in the browser process.