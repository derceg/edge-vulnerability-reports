# Summary

When a JavaScript dialog is closed, a call to BrowserView::RemoveFocusDialog will be made. However, if the original browser window has been closed, a use-after-free will occur in the browser process.

# Description

When a JavaScript dialog is shown, DialogDelegate::SetEdgeF6DialogFocusController will be called. That method will store a pointer to the specified EdgeF6DialogFocusController interface (which is implemented by BrowserView) and will then call BrowserView::SetFocusDialog.

When the dialog is then closed, DialogDelegate::RunCloseCallback will call BrowserView::RemoveFocusDialog.

However, if the original browser window has been destroyed since the dialog was opened (e.g. because the associated tab was moved to another window), DialogDelegate::RunCloseCallback will trigger a UAF, as it will attempt to call BrowserView::RemoveFocusDialog on a destroyed BrowserView instance.

## Steps to Reproduce

1. Install the attached extension.
2. Once installed, the extension will create a tab in a new window and show an alert dialog.
3. The extension will then move the tab to a new window. This will result in the original browser window (opened in the previous step) being closed.
4. The tab will then be navigated to about:blank. This will cause the JavaScript dialog to be closed, which will trigger a UAF, as described above.

Note that there appears to be a change in canary that means that DialogDelegate::RunCloseCallback may not be called when the dialog is closed in the above way. If you're testing in canary, you can still reproduce the issue by clicking the ok button in the dialog to close it. That is, the following steps should allow you to reproduce the issue when using canary:

1. Load "javascript:alert()" in a tab.
2. Move the tab to another window.
3. Close the original browser window.
4. Click the "OK" button in the alert dialog. That should trigger the same UAF as described above.